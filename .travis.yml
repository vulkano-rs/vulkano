language: rust

jobs:
  fast_finish: true
  include:
#    - os: windows
#      env: PYTHONPATH=C:\Python38
#      env: PATH="C:\Python38;$PATH"
#      rust:
#        - stable
#    - os: windows
#      env: PYTHONPATH=C:\Python38
#      env: PATH="C:\Python38;$PATH"
#      rust:
#        - nightly
    - os: linux
      dist: bionic
      rust:
        - stable

script:

after_success:
  - cd vk-sys
  - cargo owner --add AustinJ235 --token ${CRATESIO_TOKEN}
  - cd ../vulkano
  - cargo owner --add AustinJ235 --token ${CRATESIO_TOKEN}
  - cd ../vulkano-win
  - cargo owner --add AustinJ235 --token ${CRATESIO_TOKEN}
  - cd ../vulkano-shaders
  - cargo owner --add AustinJ235 --token ${CRATESIO_TOKEN}
  - |
    [ $TRAVIS_BRANCH = master ] &&
    [ $TRAVIS_PULL_REQUEST = false ] &&
    [ $TRAVIS_OS_NAME = linux ] &&
    travis_wait 30 cargo publish -j 2 --token ${CRATESIO_TOKEN} --manifest-path vk-sys/Cargo.toml
  - |
    [ $TRAVIS_BRANCH = master ] &&
    [ $TRAVIS_PULL_REQUEST = false ] &&
    [ $TRAVIS_OS_NAME = linux ] &&
    travis_wait 30 cargo publish -j 2 --token ${CRATESIO_TOKEN} --manifest-path vulkano/Cargo.toml
  - |
    [ $TRAVIS_BRANCH = master ] &&
    [ $TRAVIS_PULL_REQUEST = false ] &&
    [ $TRAVIS_OS_NAME = linux ] &&
    travis_wait 30 cargo publish -j 2 --token ${CRATESIO_TOKEN} --manifest-path vulkano-win/Cargo.toml
  - |
    [ $TRAVIS_BRANCH = master ] &&
    [ $TRAVIS_PULL_REQUEST = false ] &&
    [ $TRAVIS_OS_NAME = linux ] &&
    travis_wait 30 cargo publish -j 2 --token ${CRATESIO_TOKEN} --manifest-path vulkano-shaders/Cargo.toml
